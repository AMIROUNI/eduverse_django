<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ course.title }} - Course Details</title>
    
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/header.css' %}">
    <link rel="stylesheet" href="{% static 'css/footer.css' %}">
    <link rel="stylesheet" href="{% static 'css/detail_course.css' %}">
</head>
<body>
{% include 'includes/header.html' %}

<div class="page-container">

    {% if messages %}
    <div class="messages-container">
        {% for message in messages %}
        <div class="message {{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}

   {% if user.role == 'instructor' %}
    <!-- INSTRUCTOR VIEW - Minimal URL dependencies -->
    <section class="course-hero">
        <div class="hero-container">
            <div class="course-info">
                <h1>{{ course.title }}</h1>
                <p class="course-description">{{ course.description }}</p>
                <div class="course-meta">
                    <div class="meta-item">
                        <span class="meta-icon">üìö</span>
                        <span>Category: {{ course.category.name }}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-icon">üë•</span>
                        <span>{{ course.students.count }} enrolled students</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-icon">üìä</span>
                        <span>{{ sections|length }} sections ‚Ä¢ {{ total_lessons|default:"0" }} lessons</span>
                    </div>
                </div>
            </div>

            <div class="course-sidebar">
                <div class="course-thumbnail">
                    {% if course.thumbnail %}
                        <img src="{{ course.thumbnail.url }}" alt="{{ course.title }}" style="width:100%;height:100%;object-fit:cover;">
                    {% else %}
                        <span>üìñ</span>
                    {% endif %}
                </div>
                <div class="sidebar-content">
                    <div class="price">${{ course.price }}</div>
                    <ul class="sidebar-features">
                        <li><span class="feature-icon">‚è±Ô∏è</span>{{ sections|length }} sections</li>
                        <li><span class="feature-icon">üìÑ</span>{{ total_lessons|default:"0" }} lessons</li>
                        <li><span class="feature-icon">üì±</span>Lifetime access</li>
                        <li><span class="feature-icon">üèÜ</span>Certificate of completion</li>
                    </ul>
                    <div class="course-actions">
                        <a href="#" class="btn btn-secondary" onclick="alert('Edit feature coming soon!')">
                            <span>‚úèÔ∏è Edit Course Details</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="main-content">
        <div class="content-left">
            <!-- Add Section Form -->
            <div class="add-section-form">
                <h2 class="form-title">Add New Section</h2>
                <form method="post">
                    {% csrf_token %}
                    <div class="form-group">
                        <label class="form-label" for="id_title">Section Title</label>
                        {{ section_form.title }}
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="id_order">Order</label>
                        {{ section_form.order }}
                    </div>
                    <button type="submit" class="btn btn-primary"><span>‚ûï Add Section</span></button>
                </form>
            </div>

            <!-- Curriculum Section -->
            <div class="curriculum-section">
                <div class="section-header">
                    <h2>Course Curriculum</h2>
                    <span>{{ sections|length }} sections ‚Ä¢ {{ total_lessons|default:"0" }} lessons</span>
                </div>
                <div class="section-content">
                    {% if sections %}
                    <ul class="sections-list">
                        {% for section in sections %}
                        <li class="section-item">
                            <div class="section-item-header">
                                <div class="section-title">
                                    <span>üìÇ</span>
                                    <span>{{ section.title }}</span>
                                </div>
                                <div class="section-actions">
                                    <span class="lesson-count">{{ section.lessons.count }} lessons</span>
                                    <span class="section-order">Order: {{ section.order }}</span>
                                    <button class="btn-icon" title="Edit" onclick="alert('Edit section feature coming soon!')">‚úèÔ∏è</button>
                                    <button class="btn-icon" title="Delete" onclick="alert('Delete section feature coming soon!')">üóëÔ∏è</button>
                                </div>
                            </div>
                            <div class="section-lessons">
                                {% if section.lessons.all %}
                                <ul class="lessons-list">
                                    {% for lesson in section.lessons.all %}
                                    <li class="lesson-item">
                                        <span class="lesson-icon">‚ñ∂Ô∏è</span>
                                        <span class="lesson-title">{{ lesson.title }}</span>
                                        <span class="lesson-duration">{{ lesson.duration|default:"10" }} min</span>
                                    </li>
                                    {% endfor %}
                                </ul>
                                {% else %}
                                <div class="empty-lessons">
                                    <p>This section has no lessons yet.</p>
                                    <button class="btn btn-secondary btn-small" onclick="alert('Add lesson feature coming soon!')">
                                        <span>‚ûï Add Lesson</span>
                                    </button>
                                </div>
                                {% endif %}
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <div class="empty-state">
                        <div class="empty-icon">üìö</div>
                        <p>No sections available yet.</p>
                        <p>Create your first section to start building your course curriculum.</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- PDF Upload Section -->
            <div class="course-materials-section">
                <div class="section-header">
                    <h2>üìÅ Course Materials</h2>
                    <span>{{ course.pdf_materials.count }} PDFs uploaded</span>
                </div>
                
                <!-- PDF Upload Form -->
                <div class="pdf-upload-form">
                    <h3>Upload New PDF Material</h3>
                    <form method="post" enctype="multipart/form-data" id="pdfUploadForm">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="pdf_upload">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="pdf_title">Title:</label>
                                <input type="text" id="pdf_title" name="pdf_title" class="form-control" 
                                       placeholder="Enter PDF title" required>
                            </div>
                            <div class="form-group">
                                <label for="pdf_file">PDF File:</label>
                                <div class="file-upload-wrapper">
                                    <button type="button" class="btn btn-secondary btn-file" onclick="document.getElementById('pdf_file').click()">
                                        üìÅ Choose File
                                    </button>
                                    <span class="file-name" id="fileName">No file chosen</span>
                                    <input type="file" id="pdf_file" name="pdf_file" 
                                           accept=".pdf" required hidden
                                           onchange="document.getElementById('fileName').textContent = this.files[0]?.name || 'No file chosen'">
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <span>üì§ Upload PDF</span>
                        </button>
                    </form>
                </div>

                <!-- Quiz Generation Section - ADDED HERE -->
                <div class="quiz-generation-section">
                    <div class="section-header">
                        <h2>üéØ Generate Quiz from PDF</h2>
                        <span>Create quizzes using AI</span>
                    </div>
                    
                    <div class="quiz-generator-form">
                        <form method="post" action="." id="quizGeneratorForm">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="generate_quiz">
                            
                            <div class="form-group">
                                <label for="pdf_select">Select PDF:</label>
                                <select id="pdf_select" name="pdf_id" class="form-control" required>
                                    <option value="">-- Choose a PDF --</option>
                                    {% for pdf in course.pdf_materials.all %}
                                    <option value="{{ pdf.id }}">
                                        {{ pdf.title }} (Uploaded: {{ pdf.uploaded_at|date:"M d, Y" }})
                                    </option>
                                    {% empty %}
                                    <option value="" disabled>No PDFs uploaded yet</option>
                                    {% endfor %}
                                </select>
                                <small class="form-text">Select a PDF file to generate quizzes from.</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="num_questions">Number of Questions:</label>
                                <select id="num_questions" name="num_questions" class="form-control">
                                    <option value="3">3 Questions</option>
                                    <option value="5" selected>5 Questions</option>
                                    <option value="10">10 Questions</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="difficulty">Difficulty Level:</label>
                                <select id="difficulty" name="difficulty" class="form-control">
                                    <option value="easy">Easy</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="hard">Hard</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn btn-primary" {% if not course.pdf_materials.all %}disabled{% endif %}>
                                <span>ü§ñ Generate Quiz with AI</span>
                            </button>
                            
                            {% if not course.pdf_materials.all %}
                            <p class="text-muted" style="margin-top: 10px;">
                                <small>Upload a PDF first to generate quizzes.</small>
                            </p>
                            {% endif %}
                        </form>
                    </div>
                </div>
                
                <!-- Display uploaded PDFs -->
                {% if course.pdf_materials.all %}
                <div class="uploaded-pdfs">
                    <h3>Uploaded Materials</h3>
                    <div class="pdf-grid">
                        {% for pdf in course.pdf_materials.all %}
                        <div class="pdf-card">
                            <div class="pdf-icon">üìÑ</div>
                            <div class="pdf-content">
                                <h4>{{ pdf.title }}</h4>
                                <div class="pdf-meta">
                                    <span>Size: {{ pdf.file.size|filesizeformat }}</span>
                                    <span>‚Ä¢</span>
                                    <span>Uploaded: {{ pdf.uploaded_at|date:"M d, Y" }}</span>
                                </div>
                                <!-- Show quizzes for this PDF -->
                                {% if pdf.quizzes.all %}
                                <div class="pdf-quizzes">
                                    <small>üìù {{ pdf.quizzes.count }} quiz{{ pdf.quizzes.count|pluralize:"zes" }}</small>
                                </div>
                                {% endif %}
                            </div>
                            <div class="pdf-actions">
                                <a href="{{ pdf.file.url }}" class="btn btn-secondary btn-small" target="_blank">
                                    Download
                                </a>
                                {% if pdf.quizzes.all %}
                                <a href="{% url 'generate_quiz' pdf.id %}" class="btn btn-primary btn-small">
                                    View Quizzes
                                </a>
                                {% else %}
                                <a href="{% url 'generate_quiz' pdf.id %}" class="btn btn-secondary btn-small">
                                    Create Quiz
                                </a>
                                {% endif %}
                                <button class="btn-icon" onclick="alert('Delete feature coming soon!')" title="Delete">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% else %}
                <div class="empty-materials">
                    <div class="empty-icon">üìö</div>
                    <p>No PDF materials uploaded yet.</p>
                    <p>Upload your first PDF to share with students.</p>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="content-right">
            <!-- Instructor Section -->
            <div class="instructor-section">
                <div class="instructor-header">
                    <div class="instructor-avatar">üë®‚Äçüè´</div>
                    <div class="instructor-info">
                        <h3>{{ course.instructor.username }}</h3>
                        <p>Course Instructor</p>
                    </div>
                </div>
                <p>Experienced instructor with passion for teaching and sharing knowledge. Dedicated to helping students achieve their learning goals.</p>
                
                <div class="instructor-stats">
                    <div class="stat-item">
                        <div class="stat-number">{{ course.instructor.total_courses|default:"1" }}</div>
                        <div class="stat-label">Courses</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ course.students.count }}</div>
                        <div class="stat-label">Students</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ sections|length }}</div>
                        <div class="stat-label">Sections</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ total_lessons|default:"0" }}</div>
                        <div class="stat-label">Lessons</div>
                    </div>
                </div>
                
                <div class="quick-actions">
                    <button class="btn btn-secondary btn-small" onclick="alert('Student management feature coming soon!')">
                        <span>üë• View Students ({{ course.students.count }})</span>
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="alert('Analytics feature coming soon!')">
                        <span>üìä View Analytics</span>
                    </button>
                </div>
            </div>

            <!-- QUIZ LIST SECTION - ADDED HERE -->
            <div class="quiz-list-section" style="margin-top: 30px;">
                <div class="section-header" style="margin-bottom: 20px;">
                    <h3>üìù Course Quizzes</h3>
                    <span>{{ course.quizzes.count }} total quizzes</span>
                </div>
                
                {% if course.quizzes.all %}
                <div class="quizzes-summary">
                  
                    <div class="quizzes-by-pdf">
                        <h4>Quizzes by PDF:</h4>
                        {% for pdf in course.pdf_materials.all %}
                        {% if pdf.quizzes.all %}
                        <div class="pdf-quiz-item">
                            <div class="pdf-quiz-header">
                                <span class="pdf-icon-small">üìÑ</span>
                                <span class="pdf-title">{{ pdf.title|truncatechars:30 }}</span>                            </div>
                            <div class="pdf-quiz-actions">
                                <a href="{% url 'take_quiz' pdf.id %}" class="btn btn-primary btn-very-small">
                                    Preview
                                </a>
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                    
                {% else %}
                <div class="empty-quizzes">
                    <div class="empty-icon">üìù</div>
                    <p>No quizzes created yet.</p>
                    <p>Generate quizzes from your PDF materials.</p>
                    <a href="#quiz-generation-section" class="btn btn-primary btn-small" style="margin-top: 10px;">
                        Generate First Quiz
                    </a>
                </div>
                {% endif %}
            </div>

        </div>
    </div>

    {% elif user.role == 'student' %}
    <!-- STUDENT VIEW - Updated with better styling -->
    <section class="student-hero">
        <div class="hero-container">
            <h1>{{ course.title }}</h1>
            <p class="course-description">{{ course.description }}</p>
            
            <div class="student-meta">
                <div class="student-meta-item">
                    <span>üìö</span>
                    <span>{{ course.category.name }}</span>
                </div>
                <div class="student-meta-item">
                    <span>üë®‚Äçüè´</span>
                    <span>{{ course.instructor.username }}</span>
                </div>
                <div class="student-meta-item">
                    <span>üë•</span>
                    <span>{{ course.students.count }} students</span>
                </div>
            </div>
            
            <div class="enrollment-status">
                {% if user not in course.students.all %}
                    <form method="post" action="{% url 'enroll_course' course.id %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-success">
                            <span>üéØ Enroll in this Course</span>
                        </button>
                        <p class="enroll-info">Join {{ course.students.count }} other students</p>
                    </form>
                {% else %}
                    <div class="enrolled-status">
                        <p>‚úÖ You are enrolled in this course</p>
                        <div class="enrollment-actions">
                            <!-- Use section_detail or first section if available -->
                            {% if sections.first %}
                            {% url 'section_detail' sections.first.id as first_section_url %}
                            {% if first_section_url %}
                            <a href="{{ first_section_url }}" class="btn btn-primary">
                                <span>‚ñ∂Ô∏è Start Learning</span>
                            </a>
                            {% else %}
                            <button class="btn btn-primary" disabled>
                                <span>‚ñ∂Ô∏è Start Learning</span>
                            </button>
                            {% endif %}
                            {% else %}
                            <button class="btn btn-primary" disabled>
                                <span>‚ñ∂Ô∏è Start Learning</span>
                            </button>
                            {% endif %}
                            
                            <!-- Check if course_progress URL exists -->
                            {% url 'course_progress' course.id as progress_url %}
                            {% if progress_url %}
                            <a href="{{ progress_url }}" class="btn btn-secondary">
                                <span>üìä View Progress</span>
                            </a>
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </section>

    <!-- Curriculum Section for Students -->
    <div class="student-curriculum">
        <div class="curriculum-header">
            <h2>Course Curriculum</h2>
            <div class="section-count">{{ sections|length }} sections ‚Ä¢ {{ total_lessons|default:"0" }} lessons</div>
        </div>
        
        {% if sections %}
        <div class="curriculum-sections">
            {% for section in sections %}
            <div class="curriculum-section-item">
                <div class="section-icon">
                    {% if forloop.counter == 1 %}
                    üìñ
                    {% elif forloop.counter == 2 %}
                    üéØ
                    {% elif forloop.counter == 3 %}
                    ‚ö°
                    {% else %}
                    üìö
                    {% endif %}
                </div>
                <div class="section-content">
                    <h3>{{ section.title }}</h3>
                    <div class="section-meta">
                        <span>{{ section.lessons.count }} lessons</span>
                        <span>‚Ä¢</span>
                        <span>{{ section.total_duration|default:"60" }} min</span>
                    </div>
                </div>
                {% if user in course.students.all %}
                <div class="section-actions">
                    {% if section.progress > 0 %}
                    <div class="progress-badge">
                        {{ section.progress }}% complete
                    </div>
                    {% else %}
                    <div class="progress-badge not-started">
                        Not started
                    </div>
                    {% endif %}
                    
                    <!-- Link to section detail if available -->
                    {% url 'section_detail' section.id as section_url %}
                    {% if section_url %}
                    <a href="{{ section_url }}" class="btn btn-secondary btn-small">
                        View Lessons
                    </a>
                    {% endif %}
                </div>
                {% else %}
                <div class="section-actions">
                    <div class="locked-badge">
                        üîí
                    </div>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-curriculum">
            <div class="empty-icon">üìö</div>
            <p>No sections available yet.</p>
            <p>The instructor is currently preparing the course content.</p>
        </div>
        {% endif %}
    </div>
    
    <!-- Course Details Section -->
    <div class="course-details">
        <div class="details-grid">
            <div class="detail-card">
                <div class="detail-icon">üë®‚Äçüè´</div>
                <h3>Instructor</h3>
                <p>{{ course.instructor.username }}</p>
                <p class="detail-description">Experienced instructor dedicated to student success</p>
            </div>
            
            <div class="detail-card">
                <div class="detail-icon">üéØ</div>
                <h3>Prerequisites</h3>
                <p>Basic programming knowledge</p>
                <p class="detail-description">Beginner-friendly course with step-by-step guidance</p>
            </div>
            
            <div class="detail-card">
                <div class="detail-icon">üìÖ</div>
                <h3>Last Updated</h3>
                <p>{{ course.updated_at|date:"F j, Y" }}</p>
                <p class="detail-description">Regularly updated with new content</p>
            </div>
            
            <div class="detail-card">
                <div class="detail-icon">üèÜ</div>
                <h3>Certificate</h3>
                <p>Completion Certificate</p>
                <p class="detail-description">Earn a certificate upon course completion</p>
            </div>
        </div>
    </div>
    {% endif %}
</div>

{% include 'includes/footer.html' %}

<style>
    /* Additional styles for quiz and lesson sections */
    .quiz-list-section, .lesson-list-section {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        border: 1px solid #e0e0e0;
    }
    
    .summary-card {
        display: flex;
        align-items: center;
        background: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .summary-icon {
        font-size: 24px;
        margin-right: 15px;
    }
    
    .summary-content h4 {
        margin: 0 0 5px 0;
        font-size: 16px;
    }
    
    .summary-content p {
        margin: 0;
        font-size: 14px;
        color: #666;
    }
    
    .pdf-quiz-item, .section-lesson-item {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 10px;
    }
    
    .pdf-quiz-header, .section-lesson-header {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
    }
    
    .pdf-icon-small, .section-icon {
        margin-right: 10px;
        font-size: 18px;
    }
    
    .pdf-title, .section-title {
        flex-grow: 1;
        font-weight: 500;
    }
    
    .quiz-count, .lesson-count {
        background: #667eea;
        color: white;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
    }
    
    .pdf-quiz-actions {
        display: flex;
        gap: 8px;
        margin-top: 8px;
    }
    
    .btn-very-small {
        padding: 4px 10px !important;
        font-size: 12px !important;
    }
    
    .recent-quiz-item, .recent-lesson-item, .lesson-item-small {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        padding: 10px;
        margin-bottom: 8px;
    }
    
    .quiz-question, .lesson-info {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
    }
    
    .quiz-number {
        background: #667eea;
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
        font-size: 12px;
    }
    
    .quiz-text, .lesson-title {
        flex-grow: 1;
    }
    
    .quiz-meta, .lesson-meta {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        color: #666;
    }
    
    .section-lesson-list {
        margin-top: 8px;
    }
    
    .lesson-item-small {
        display: flex;
        align-items: center;
        padding: 8px;
        margin-bottom: 5px;
        background: white;
    }
    
    .lesson-icon-small {
        margin-right: 8px;
        font-size: 14px;
    }
    
    .lesson-title-small {
        flex-grow: 1;
        font-size: 13px;
    }
    
    .lesson-duration-small {
        font-size: 12px;
        color: #666;
    }
    
    .lesson-more, .no-lessons {
        text-align: center;
        padding: 5px;
        font-size: 12px;
        color: #666;
    }
    
    .empty-quizzes, .empty-lessons {
        text-align: center;
        padding: 30px 20px;
    }
    
    .empty-quizzes .empty-icon, .empty-lessons .empty-icon {
        font-size: 48px;
        margin-bottom: 15px;
        display: block;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize form fields with proper classes
    const formInputs = document.querySelectorAll('input, select, textarea');
    formInputs.forEach(input => {
        input.classList.add('form-control');
    });
    
    // Section accordion functionality for instructor view
    const sectionHeaders = document.querySelectorAll('.section-item-header');
    sectionHeaders.forEach(header => {
        header.addEventListener('click', function() {
            const content = this.nextElementSibling;
            if (content.classList.contains('section-lessons')) {
                content.style.display = content.style.display === 'none' ? 'block' : 'none';
            }
        });
    });
    
    // Add toggle icon for sections
    sectionHeaders.forEach(header => {
        const toggleIcon = document.createElement('span');
        toggleIcon.className = 'toggle-icon';
        toggleIcon.innerHTML = '‚ñº';
        toggleIcon.style.cursor = 'pointer';
        toggleIcon.style.marginLeft = '10px';
        
        const sectionTitle = header.querySelector('.section-title');
        if (sectionTitle) {
            sectionTitle.appendChild(toggleIcon);
            
            toggleIcon.addEventListener('click', function(e) {
                e.stopPropagation();
                const content = header.nextElementSibling;
                if (content.classList.contains('section-lessons')) {
                    const isHidden = content.style.display === 'none';
                    content.style.display = isHidden ? 'block' : 'none';
                    toggleIcon.innerHTML = isHidden ? '‚ñ≤' : '‚ñº';
                }
            });
        }
    });
    
    // Initialize all section lessons as hidden by default
    document.querySelectorAll('.section-lessons').forEach(lesson => {
        lesson.style.display = 'none';
    });
    
    // Progress animation for student view
    const progressBadges = document.querySelectorAll('.progress-badge');
    progressBadges.forEach(badge => {
        const text = badge.textContent;
        if (text.includes('%')) {
            const percent = parseInt(text);
            badge.style.setProperty('--progress', `${percent}%`);
            
            // Add color based on progress
            if (percent >= 80) {
                badge.classList.add('high-progress');
            } else if (percent >= 40) {
                badge.classList.add('medium-progress');
            } else {
                badge.classList.add('low-progress');
            }
        }
    });
    
    // File upload preview
    const pdfFileInput = document.getElementById('pdf_file');
    const fileNameSpan = document.getElementById('fileName');
    
    if (pdfFileInput && fileNameSpan) {
        pdfFileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                const file = this.files[0];
                fileNameSpan.textContent = file.name;
                fileNameSpan.style.color = 'var(--color-600)';
                
                // Validate file size (optional - 10MB limit)
                const maxSize = 10 * 1024 * 1024; // 10MB
                if (file.size > maxSize) {
                    alert('File is too large! Maximum size is 10MB.');
                    this.value = '';
                    fileNameSpan.textContent = 'No file chosen';
                    fileNameSpan.style.color = 'var(--color-400)';
                }
                
                // Validate file type
                if (!file.name.toLowerCase().endsWith('.pdf')) {
                    alert('Only PDF files are allowed!');
                    this.value = '';
                    fileNameSpan.textContent = 'No file chosen';
                    fileNameSpan.style.color = 'var(--color-400)';
                }
            } else {
                fileNameSpan.textContent = 'No file chosen';
                fileNameSpan.style.color = 'var(--color-400)';
            }
        });
    }
    
    // Handle PDF form submission with loading state
    const pdfUploadForm = document.getElementById('pdfUploadForm');
    if (pdfUploadForm) {
        pdfUploadForm.addEventListener('submit', function() {
            const submitBtn = this.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.innerHTML = '<span>‚è≥ Uploading...</span>';
                submitBtn.disabled = true;
            }
        });
    }
    
    // Handle quiz generation form
    const quizGeneratorForm = document.getElementById('quizGeneratorForm');
    if (quizGeneratorForm) {
        quizGeneratorForm.addEventListener('submit', function() {
            const submitBtn = this.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.innerHTML = '<span>‚è≥ Generating with AI...</span>';
                submitBtn.disabled = true;
                submitBtn.classList.add('loading');
            }
        });
        
        // Update button state based on PDF selection
        const pdfSelect = document.getElementById('pdf_select');
        if (pdfSelect) {
            pdfSelect.addEventListener('change', function() {
                const submitBtn = quizGeneratorForm.querySelector('button[type="submit"]');
                if (submitBtn) {
                    submitBtn.disabled = this.value === '';
                }
            });
        }
    }
    
    // Smooth scroll to quiz generation section
    const generateQuizLink = document.querySelector('a[href="#quiz-generation-section"]');
    if (generateQuizLink) {
        generateQuizLink.addEventListener('click', function(e) {
            e.preventDefault();
            const quizSection = document.querySelector('.quiz-generation-section');
            if (quizSection) {
                quizSection.scrollIntoView({ behavior: 'smooth' });
            }
        });
    }
});
</script>
</body>
</html>